"use strict";function asyncGeneratorStep(e,t,r,n,o,a,s){try{var c=e[a](s),i=c.value}catch(e){return void r(e)}c.done?t(i):Promise.resolve(i).then(n,o)}function _asyncToGenerator(c){return function(){var e=this,s=arguments;return new Promise(function(t,r){var n=c.apply(e,s);function o(e){asyncGeneratorStep(n,t,r,o,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}Object.defineProperty(exports,"__esModule",{value:!0});var R=require("ramda"),_require=require("./utils"),getHtmlFromPage=_require.getHtmlFromPage,WebtoonParser=function(){function e(){_classCallCheck(this,e),this.comicsList=[]}var t,r,n,o;return _createClass(e,[{key:"getComicsListHTML",value:(o=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,getHtmlFromPage("https://www.webtoons.com/en/genre");case 3:return t=e.sent,r=t.getElementsByClassName("card_lst"),n=r.reduce(function(e,t){var r=t.getElementsByTagName("li");return e.push(r),e},[]),e.abrupt("return",R.flatten(n));case 9:e.prev=9,e.t0=e.catch(0),console.error("Parses comics html failed",e.t0);case 12:case"end":return e.stop()}},e,null,[[0,9]])})),function(){return o.apply(this,arguments)})},{key:"getBaseComicsInfo",value:function(e){try{return{link:e.getElementsByTagName("a")[0].getAttribute("href"),image:e.getElementsByTagName("img")[0].getAttribute("src"),name:e.getElementsByClassName("subj")[0].textContent,author:e.getElementsByClassName("author")[0].textContent}}catch(e){console.error("Error while parse comics item")}}},{key:"getFullInfo",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,a,s,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,getHtmlFromPage("".concat(t.link,"&page=1"));case 3:return r=e.sent,n=r.getElementsByClassName("cnt"),o=n[0].textContent,a=n[1].textContent,s=r.getElementById("_listUl"),c=s.childNodes[1],i=c.getElementsByClassName("subj")[0].textContent,e.abrupt("return",_objectSpread2(_objectSpread2({},t),{},{views:o,rating:a,countEpisodes:i}));case 13:e.prev=13,e.t0=e.catch(0),console.log("-------------------------------"),console.error("Error while parse full comics info - ",t.name),console.log("-------------------------------");case 18:case"end":return e.stop()}},e,null,[[0,13]])})),function(e){return n.apply(this,arguments)})},{key:"getEpisodeImagesPath",value:function(e){return e.reduce(function(e,t){return e.push(t.getAttribute("data-url")),e},[])}},{key:"getEpisodeByUrl",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getHtmlFromPage("".concat(t,"&episode_no=1"));case 2:return r=e.sent,n=r.getElementsByTagName("h1")[0].textContent,o=r.getElementsByClassName("viewer_img")[0],a=o.getElementsByTagName("img"),s=this.getEpisodeImagesPath(a),e.abrupt("return",{title:n,content:s});case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getComicsList",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getComicsListHTML();case 2:return t=e.sent,this.comicsList=t.map(this.getBaseComicsInfo),e.abrupt("return",this.comicsList);case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),e}();exports.WebtoonParser=WebtoonParser;
